<!doctype html>
<head>
  <title>Stamping bug</title>
  <script src="https://polygit.org/polymer+^1.9.1/webcomponentsjs+^0.7.0/components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import"  href="https://polygit.org/polymer+^1.9.1/webcomponentsjs+^0.7.0/components/polymer/polymer.html">
</head>
<body>

<dom-module id="x-showhide">
  <template>
    <template is="dom-if" if="[[showContents]]" restamp>
      <slot></slot>
    </template>
  </template>
  <script>Polymer({is: "x-showhide"});</script>
</dom-module>

<dom-module id="x-wrapper">
  <template><slot></slot></template>
  <script>Polymer({is: "x-wrapper"});</script>
</dom-module>

<dom-module id="x-example">
  <template>
    Text: <input value="{{boundText::input}}">
    Outer: <input type="checkbox" checked="{{showOuter::change}}">
    Inner: <input type="checkbox" checked="{{showInner::change}}">
    <x-showhide show-contents="[[showOuter]]">
      <x-wrapper>
        <template is="dom-repeat" items="[[_items(showInner)]]">
          <div>Repeat</div>
          <!-- restamp here makes no difference -->
          <template is="dom-if" if="[[item]]">
            <div>Bound text: [[boundText]]</div>
          </template>
        </template>
      </x-wrapper>
    </x-showhide>
  </template>
  <script>
    Polymer({
      is: 'x-example',
      properties: {
        showInner: {
          type: Boolean,
          value: true,
        },
        showOuter: {
          type: Boolean,
          value: true,
        },
      },
      _items(show) {
        return show ? [true] : [];
      },
    });
  </script>
</dom-module>

<x-example></x-example>
</body>
